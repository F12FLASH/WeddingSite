@echo off
chcp 65001 >nul
cls
echo.
echo ============================================================
echo    üíç WEDDING WEBSITE - SETUP SCRIPT (Windows)
echo ============================================================
echo.

REM Check if Node.js is installed
echo [1/6] Ki·ªÉm tra Node.js...
node -v >nul 2>&1
if %errorlevel% neq 0 (
    echo ‚ùå Node.js ch∆∞a ƒë∆∞·ª£c c√†i ƒë·∫∑t!
    echo.
    echo Vui l√≤ng t·∫£i v√† c√†i ƒë·∫∑t Node.js t·ª´: https://nodejs.org/
    echo Ch·ªçn phi√™n b·∫£n LTS (Recommended for Most Users)
    echo.
    pause
    exit /b 1
)

echo ‚úÖ Node.js ƒë√£ c√†i ƒë·∫∑t
node -v
echo.

REM Check if npm is installed
echo [2/6] Ki·ªÉm tra npm...
npm -v >nul 2>&1
if %errorlevel% neq 0 (
    echo ‚ùå npm kh√¥ng t√¨m th·∫•y!
    pause
    exit /b 1
)
echo ‚úÖ npm ƒë√£ c√†i ƒë·∫∑t
npm -v
echo.

REM Install dependencies
echo [3/6] C√†i ƒë·∫∑t dependencies...
echo ƒê√¢y c√≥ th·ªÉ m·∫•t 2-3 ph√∫t, vui l√≤ng ƒë·ª£i...
echo.
call npm install
if %errorlevel% neq 0 (
    echo.
    echo ‚ùå L·ªói khi c√†i ƒë·∫∑t dependencies!
    echo.
    echo Th·ª≠ ch·∫°y l·ªánh sau ƒë·ªÉ x√≥a cache v√† c√†i l·∫°i:
    echo   rd /s /q node_modules
    echo   del package-lock.json
    echo   npm install
    echo.
    pause
    exit /b 1
)
echo.
echo ‚úÖ Dependencies ƒë√£ ƒë∆∞·ª£c c√†i ƒë·∫∑t th√†nh c√¥ng!
echo.

REM Check if .env exists
echo [4/6] Ki·ªÉm tra file .env...
if exist .env (
    echo ‚ö†Ô∏è  File .env ƒë√£ t·ªìn t·∫°i. B·ªè qua b∆∞·ªõc n√†y.
    echo    N·∫øu mu·ªën t·∫°o l·∫°i, x√≥a file .env v√† ch·∫°y l·∫°i setup.bat
) else (
    echo T·∫°o file .env m·ªõi...
    (
        echo # Database Connection
        echo DATABASE_URL=postgresql://user:password@localhost:5432/wedding_db
        echo.
        echo # Session Secret (generate b·∫±ng: node -e "console.log(require('crypto'^).randomBytes(32^).toString('hex'^)^)"^)
        echo SESSION_SECRET=change_this_to_a_random_64_character_string_for_security
        echo.
        echo # Environment
        echo NODE_ENV=development
    ) > .env
    echo ‚úÖ File .env ƒë√£ ƒë∆∞·ª£c t·∫°o!
    echo.
    echo ‚ö†Ô∏è  QUAN TR·ªåNG: Vui l√≤ng c·∫≠p nh·∫≠t file .env v·ªõi th√¥ng tin th·∫≠t:
    echo    1. DATABASE_URL - Connection string c·ªßa PostgreSQL
    echo    2. SESSION_SECRET - Chu·ªói ng·∫´u nhi√™n 64 k√Ω t·ª±
    echo.
)
echo.

REM Database setup instructions
echo [5/6] H∆∞·ªõng d·∫´n setup Database...
echo.
echo B·∫°n c·∫ßn setup PostgreSQL database. C√≥ 2 l·ª±a ch·ªçn:
echo.
echo üìå OPTION 1: Neon DB (Khuy√™n d√πng - Mi·ªÖn ph√≠, d·ªÖ d√πng)
echo    1. Truy c·∫≠p: https://console.neon.tech/
echo    2. ƒêƒÉng k√Ω t√†i kho·∫£n mi·ªÖn ph√≠
echo    3. T·∫°o project m·ªõi t√™n "WeddingSite"
echo    4. Copy "Connection String"
echo    5. Paste v√†o .env file (thay th·∫ø DATABASE_URL)
echo.
echo üìå OPTION 2: PostgreSQL Local
echo    1. C√†i PostgreSQL t·ª´: https://www.postgresql.org/download/windows/
echo    2. T·∫°o database: createdb wedding_db
echo    3. Update DATABASE_URL trong .env
echo.
echo Sau khi setup database, ch·∫°y c√°c l·ªánh sau:
echo   npm run db:push           (t·∫°o tables)
echo   npx tsx server/seed.ts    (th√™m d·ªØ li·ªáu m·∫´u)
echo.
pause
echo.

REM Generate SESSION_SECRET
echo [6/6] T·∫°o SESSION_SECRET ng·∫´u nhi√™n...
echo.
echo Ch·∫°y l·ªánh sau ƒë·ªÉ t·∫°o SESSION_SECRET:
echo   node -e "console.log(require('crypto').randomBytes(32).toString('hex'))"
echo.
echo Copy k·∫øt qu·∫£ v√† paste v√†o file .env (thay th·∫ø SESSION_SECRET)
echo.
pause

echo.
echo ============================================================
echo    ‚úÖ SETUP HO√ÄN T·∫§T!
echo ============================================================
echo.
echo B∆Ø·ªöC TI·∫æP THEO:
echo   1. M·ªü file .env v√† c·∫≠p nh·∫≠t DATABASE_URL, SESSION_SECRET
echo   2. Ch·∫°y: npm run db:push
echo   3. Ch·∫°y: npx tsx server/seed.ts
echo   4. Ch·∫°y: npm run dev
echo.
echo HO·∫∂C s·ª≠ d·ª•ng file start.bat ƒë·ªÉ ch·∫°y nhanh!
echo.
echo Admin Login:
echo   Username: admin
echo   Password: admin123
echo   (Nh·ªõ ƒë·ªïi m·∫≠t kh·∫©u sau khi login!)
echo.
echo Website s·∫Ω ch·∫°y t·∫°i: http://localhost:5000
echo.
pause
